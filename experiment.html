<!DOCTYPE html>
<html>
<head>
   
    <!-- <link href="css/experiment copy.css" rel="stylesheet" type="text/css">
    <link href="css/experiment copy.css.map" rel="stylesheet" type="text/css"> -->
    <script src="js/jsPsych/jspsych.js"></script>
    <script src="js/jsPsych/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="js/jsPsych/plugins/jspsych-html-button-response.js"></script>
    <script src="js/jsPsych/plugins/jspsych-html-image-response.js"></script>
    <script src="js/jsPsych/plugins/jspsych-preload.js"></script>
    <script src="js/jsPsych/extensions/jspsych-ext-webgazer.js"></script>
    <script src="js/jsPsych/plugins/jspsych-webgazer-init-camera.js"></script>
    <script src="js/jsPsych/plugins/jspsych-webgazer-calibrate.js"></script>
    <script src="js/jsPsych/plugins/jspsych-webgazer-validate.js"></script>
    <script src="js/webgazer.js"></script>
    <link href="js/jsPsych/css/jspsych.css" rel="stylesheet" type="text/css">

</head>
<body>
    <!-- <div class="wrapper" id="wrapper">
         <canvas id="plotting_canvas" width="" height="" style="cursor: pointer; position: fixed;"> </canvas>  
        <button class="start" id="start"><a href="#">start the experiment </a></button>
          <div class="card" id="card">
            <div class="b">
              <p>Calibration</p>
                <p>Remember to grant you camera access to the browser to proceed to the experiment!</p>
            </div>
              <div class="button">
                  <button>Send</button>
                      <button class="cancel-btn">Cancel</button>
                  </div>
                      <button onclick="closeModal()" class="close">
                          &#x2716;
                      </button>
              </div>
                <section class="vidbox">
                  <video id="vid1" controls width="768">
                  <source src="violence.mp4" type="video/mp4">
                  </video>

                  <video id="vid2" controls width="768">
                    <source src="sex.mp4" type="video/mp4">
                  </video>
                </section>
    </div> -->

 <!-- <script>
        function openModal(){
    const open = document.getElementById("card");
    open.style.display="flex";
    open.style.width="300px";
  };
  
  //close the box modal
  function closeModal(){
    const close = document.getElementById("card");
    close.style.display="none";
  };
    </script> -->

</body>
<script>
  var timeline=[];
  var preload = {
      type: 'preload',
      video: ['vid/sex.mp4', 'vid/violence.mp4']
    }
    timeline.push(preload);

  var welcome = {
  type: 'html-button-response',
  stimulus: `<p>Welcome to Ishtar, the neurobiological experience. Press any button to begin.</p>`,
  choices: ['Violence', 'Sex'],
  prompt: "<p>This choice won't affect the final report</p>",
  button_html:'<button class="jspsych-btn">%choice%</button>'
  };
  timeline.push(welcome);

  var init_camera_trial = {
  type: "webgazer-init-camera"

  };

  timeline.push(init_camera_trial);

    var instructions = {
      type: "html-button-response",
      stimulus: `
        <p>In this experiment you'll see appearing two different types of content: <br />
          on the left, a <strong>violent</strong> one and on the right an <strong>erotic</strong> content.</p>
        <p>These content will appear randomly unless you select one of the hashtag</p>
        <p>Before approaching the experiment, you'll be asked to make an eye gaze calibration test</p>
        <div class='container' style='width: 100%;'>
          <div class='vidSection' style='display:flex;flex-direction:row;justify-content:space-between;'>
            <video controls autoplay src='vid/sex.mp4' style='justify-self:flex-start;'></video>
            <video controls autoplay src='vid/violence.mp4' style='justify-self:flex-end;'></video>
          </div>
          <p>Click on the button to access the calibration test</p>
        </div>
      `,
      choices: ['Proceed'],
      button_html:'<button class="jspsych-btn">%choice%</button>',
      post_trial_gap: true
    };
    timeline.push(instructions);

    var pre_calib = {
  type: 'html-button-response',
  stimulus: `<p style="text-align:left;">Before starting, you'll need to complete our calibration test by gazing straight to the gray points that'll appear</p>
  <h4>In order to complete the calibration efficiently, remember to:</h4>
  <ul style="text-align:left;">
    <li>
      Perform the eye tracking experiments in a well-lit room.
      </li>
      <li>
        Keep your head relatively still during and after calibration.
      </li>
      <li>
        Keep your device on an average distance of 15,7 inches (40cm) during both calibration and experiment. 
      </li>
      <li>
        Close any non-essential software and browser windows prior to completing the experiment.
      </li>
    </<ul>`,
  choices: ["Proceed"],
  button_html:'<button class="jspsych-btn">%choice%</button>'
  };
  timeline.push(pre_calib);


    var calibration = {
        type: 'webgazer-calibrate',
        calibration_points: [[10,10],[10,50],[10,90],
          [70,10],[70,50],[70,90]],
        calibration_mode: 'view',
        time_to_saccade:2000,
        time_per_point:2000,
        randomize_calibration_order:true,
        repetitions_per_point:1
      };
      timeline.push(calibration);


      var validation= {
      type: 'webgazer-validate',
      validation_points: [[-400,400],[400,400],[-400,-400],[400,-400]],
      validation_point_coordinates: 'center-offset-pixels',
      roi_radius: 100,
      show_validation_data:true,
      time_to_saccade:2000,
      time_per_point:2000,
      point_size:20,
      data: {
        raw_gaze:[],
        percent_in_roi:[],
        validation_points:[],
      },
     };


    timeline.push(validation);

    var fixation = {
      type: 'image-buttons-response',
      stimulus: ` <div class='container' style='width: 100%;'>
          <div class='vidSection' style='display:flex;flex-direction:row;justify-content:space-between;'>
            <video controls autoplay src='vid/sex.mp4' style='justify-self:flex-start;'></video>
            <video controls autoplay src='vid/violence.mp4' style='justify-self:flex-end;'></video>
          </div>
        </div>
       
      `,
      choices:['Violence', 'Sex'],
      trial_duration: 2000,
      extensions: [
        {
          type: 'webgazer', 
          params: {targets: ['#jspsych-image-keyboard-response-stimulus'],
                    wegazer_data:[],
                    webgazer_targets:[]
                  }
                }
              ]
            };
            
            timeline.push(fixation);

 
//     var test = {
//       type: "image-keyboard-response",
//       stimulus: jsPsych.timelineVariable('stimulus'),
//       choices: ['f', 'j'],
//       data: {
//         task: 'response', 
//         correct_response:jsPsych.timelineVariable('correct_response')
//       },
//       on_finish: function(data){
//         data.correct = jsPsych.pluginAPI.compareKeys(data.response, data.correct_response);
//       }
//     }
//     var test_procedure = {
//           timeline: [fixation, test],
//           timeline_variables: test_stimuli,
//           randomize_order:true,
//           repetitions:5
//         }
    

//     timeline.push(test_procedure);

//     var debrief_block = {
//     type: "html-keyboard-response",
//     stimulus: function() {

//         var trials = jsPsych.data.get().filter({task: 'response'});
//         var correct_trials = trials.filter({correct: true});
//         var accuracy = Math.round(correct_trials.count() / trials.count() * 100);
//         var rt = Math.round(correct_trials.select('rt').mean());

//         return `<p>You responded correctly on ${accuracy}% of the trials.</p>
//           <p>Your average response time was ${rt}ms.</p>
//           <p>Press any key to complete the experiment. Thank you!</p>`;

//       }
//     };

// timeline.push(debrief_block);

/* start the experiment */
jsPsych.init({
  timeline: timeline,
  extensions: [
    {
      type: 'webgazer',
      params: {
        auto_initialize:true,
        round_predictions:true
      }
  }
  ],
  on_finish: function() {
        jsPsych.data.displayData();
      }
});
</script>

</html>