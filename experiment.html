<!DOCTYPE html>
<html>
<head>
   
    <!-- <link href="css/experiment copy.css" rel="stylesheet" type="text/css">
    <link href="css/experiment copy.css.map" rel="stylesheet" type="text/css"> -->
    <script src="js/jsPsych/jspsych.js"></script>
    <script src="js/jsPsych/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="js/jsPsych/plugins/jspsych-html-button-response.js"></script>
    <script src="js/jsPsych/plugins/jspsych-video-button-response.js"></script>
    <script src="js/jsPsych/plugins/jspsych-preload.js"></script>
    <script src="js/jsPsych/extensions/jspsych-ext-webgazer.js"></script>
    <script src="js/jsPsych/plugins/jspsych-webgazer-init-camera.js"></script>
    <script src="js/jsPsych/plugins/jspsych-webgazer-calibrate.js"></script>
    <script src="js/jsPsych/plugins/jspsych-webgazer-validate.js"></script>
    <script src="js/webgazer.js"></script>
    
    <link href="css/experiment.css" rel="stylesheet" type="text/css">
    <link href="css/master.css" rel="stylesheet" type="text/css">
    <link href="js/jsPsych/css/jspsych.css" rel="stylesheet" type="text/css">

    <style>

    </style>

</head>
<body>
    <!-- <div class="wrapper" id="wrapper">
         <canvas id="plotting_canvas" width="" height="" style="cursor: pointer; position: fixed;"> </canvas>  
        <button class="start" id="start"><a href="#">start the experiment </a></button>
          <div class="card" id="card">
            <div class="b">
              <p>Calibration</p>
                <p>Remember to grant you camera access to the browser to proceed to the experiment!</p>
            </div>
              <div class="button">
                  <button>Send</button>
                      <button class="cancel-btn">Cancel</button>
                  </div>
                      <button onclick="closeModal()" class="close">
                          &#x2716;
                      </button>
              </div>
                <section class="vidbox">
                  <video id="vid1" controls width="768">
                  <source src="violence.mp4" type="video/mp4">
                  </video>

                  <video id="vid2" controls width="768">
                    <source src="sex.mp4" type="video/mp4">
                  </video>
                </section>
    </div> -->

 <!-- <script>
        function openModal(){
    const open = document.getElementById("card");
    open.style.display="flex";
    open.style.width="300px";
  };
  
  //close the box modal
  function closeModal(){
    const close = document.getElementById("card");
    close.style.display="none";
  };
    </script> -->

</body>
<script>
  var timeline=[];
  var preload = {
      type: 'preload',
      video: [
      'vid/sex.mp4',
    'vid/sex_2.mp4',
    'vid/sex_3.mp4',
    'vid/sex_4.mp4',
   'vid/violence.mp4',
    'vid/violence_2.mp4',
    'vid/violence_3.mp4',
    'vid/violence_4.mp4'
]
    }
    timeline.push(preload);

  var welcome = {
  type: 'html-button-response',
  stimulus: `<p>Welcome to Ishtar, the neurobiological experience. Press any button to begin.</p>
      <p>This experiment uses your camera for eye tracking.</p>
      <p>In order to participate you must allow the experiment to use your camera.</p>
      <p>You will be prompted to do this on the next screen.</p>
      <p>If you do not want to permit the experiment to use your camera, please close the page.</p>
    `,
    choices: ['Click to begin'],
    button_html:'<button class="buttonish">%choice%</button>',
    post_trial_gap: 1000
  };
  timeline.push(welcome);

  // var init_camera_trial = {
  // type: "webgazer-init-camera"

  // };

  // timeline.push(init_camera_trial);

    var instructions = {
      type: "html-button-response",
      stimulus: `
        <p>In this experiment you'll see appearing two different types of content: <br />
          on the right, a <strong>violent</strong> one and on the left an <strong>erotic</strong> content.</p>
        <p>These content will appear randomly selected from a group of 35 videos for each category</p>
        <div class='container' style='width: 100%;'>
          <div class='vidSection' style='display:flex;flex-direction:row;justify-content:space-between;'>
            <video controls autoplay src='vid/sex.mp4' style='justify-self:flex-start;'></video>
            <video controls autoplay src='vid/violence.mp4' style='justify-self:flex-end;'></video>
          </div>
          <p>Click on the button to access the calibration test</p>
        </div>
      `,
      choices: ['Proceed'],
      button_html:'<button class="buttonish">%choice%</button>',
      post_trial_gap: 1000
    };
    timeline.push(instructions);

  

    // var test_stimuli =['vid/sex.mp4','vid/violence.mp4'];
    // var n_loaded = 0;

    // jsPsych.pluginAPI.preloadVideo(test_stimuli, function(){ startExperiment(); }, function(file) { updateLoadedCount(file); });

    // function updateLoadedCount(file){
    //   n_loaded++;
    //     var percentcomplete = n_loaded / test_stimuli.length * 100;

    //     // could put something fancier here, like a progress bar
    //     // or updating text in the DOM.
    //     console.log('Loaded '+percentcomplete+'% of videos');
    // }

    // function startExperiment(){
    //   jsPsych.init({
    //     timeline: exp
    //   })
    // };

    var test_violent =[
    {video:'vid/violence.mp4'},
    {video:'vid/violence_2.mp4'},
    {video:'vid/violence_3.mp4'},
    {video:'vid/violence_4.mp4'}
  ]


  var test_sex =[
    {video:'vid/sex.mp4'},
    {video:'vid/sex_2.mp4'},
    {video:'vid/sex_3.mp4'},
    {video:'vid/sex_4.mp4'}
  ]


    var test = {
      type: 'video-button-response',
      stimulus:['vid/sex.mp4','vid/violence_4.mp4'],
        width:400,
        height:200,
        autoplay:true,
        controls:true,
      choices:['true','false'],
  
      data:{
        task:'response',
        left_response:jsPsych.timelineVariable('true')
      }
      // trial_ends_after_video:true,
      // on_finish: function(data){
      //   data.valid = jsPsych.pluginAPI.compareKeys(data.response, data.left_response);
      // }
    }
  

    var test_procedure = {
          timeline: test,
          timeline_variables: test_violent,test_sex,
          repetitions:4,
          randomize_order: true
    };

    timeline.push(test_procedure);

    var debrief_block = {
    type: "html-keyboard-response",
    stimulus: function() {

        var exit = jsPsych.data.get().filter({task: 'response'});
        var v_exit = exit.filter({valid: true});
        var accuracy = Math.round(v_exit.count() / exit.count() * 100);
        var rt = Math.round(v_exit.select('rt').mean());

        return `<p>You responded correctly on ${accuracy}% of the trials.</p>
          <p>Your average response time was ${rt}ms.</p>
          <p>Press any key to complete the experiment. Thank you!</p>`;

      }
    };

timeline.push(debrief_block);


// var test_procedure = {
//     timeline: [calibration, validation, test],
//     on_timeline_start: function() {
//         alert('The trial procedure just started.')
//     },
//     on_timeline_finish: function() {
//         alert('The trial procedure just finished.')
//     }
// }

/* start the experiment */
jsPsych.init({
  timeline: timeline,
  extensions: [
    {
      type: 'webgazer',
      params: {
        auto_initialize:false,
        round_predictions:true,
      }
  }
  ],
  on_finish: function() {
        jsPsych.data.displayData();
      }
});
</script>

</html>